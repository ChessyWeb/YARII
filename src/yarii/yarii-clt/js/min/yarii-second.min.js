(function(yarii,window,document,navigator){"use strict";yarii.options=yarii.options||{};var opts=yarii.options,speedTestUri=opts.speedTestUri||'http://guil.chessyweb.com/build_0.3/libs/yarii/speed-test/',speedTestKB=opts.speedTestKB||25,minKbpsForHighBandwidth=opts.minKbpsForHighBandwidth||100,speedTestExpireMinutes=opts.speedTestExpireMinutes||30,BANDWIDTH='bandwidth',CONNECTION_KBPS='connKbps',CONNECTION_TYPE='connType',CONNECTION_TEST_RESULT='connTestResult',STATUS_LOADING='loading',STATUS_COMPLETE='complete',CONNECTION_TYPE_SLOW='connTypeSlow',LOCAL_STORAGE_KEY='yarii',speedConnectionStatus,speedTest=function(){if(speedConnectionStatus)return;var connection=navigator.connection||{type:'unknown'};var isSlowConnection=connection.type==3||connection.type==4||/^[23]g$/.test(connection.type);yarii[CONNECTION_TYPE]=connection.type;if(isSlowConnection){yarii[CONNECTION_TEST_RESULT]=CONNECTION_TYPE_SLOW;yarii[CONNECTION_KBPS]=1;speedConnectionStatus=STATUS_COMPLETE;return;}
var
speedTestImg=document.createElement('img'),endTime,startTime,speedTestTimeoutMS;speedTestImg.onload=function(){endTime=(new Date()).getTime();var duration=(endTime-startTime)/1000;yarii[CONNECTION_KBPS]=((speedTestKB*1024*8)/duration)/1024||1;yarii[BANDWIDTH]=(yarii[CONNECTION_KBPS]>=minKbpsForHighBandwidth?'high':'low');speedTestComplete('networkSuccess');};speedTestImg.onerror=function(){speedTestComplete('networkError',5);};speedTestImg.onabort=function(){speedTestComplete('networkAbort',5);};startTime=(new Date()).getTime();speedConnectionStatus=STATUS_LOADING;if(document.location.protocol==='https:'){speedTestUri=speedTestUri.replace('http:','https:');}
speedTestImg.src=speedTestUri+speedTestKB+"K.jpg?r="+Math.random();speedTestTimeoutMS=(((speedTestKB*8)/minKbpsForHighBandwidth)*1000)+350;setTimeout(function(){yarii[CONNECTION_KBPS]=minKbpsForHighBandwidth/2;speedTestComplete('networkSlow');},speedTestTimeoutMS);},speedTestComplete=function(connTestResult,expireMinutes){if(speedConnectionStatus===STATUS_COMPLETE)return;speedConnectionStatus=STATUS_COMPLETE;yarii[CONNECTION_TEST_RESULT]=connTestResult;var connection_kbps=Math.round(yarii[CONNECTION_KBPS]);if(isNaN(connection_kbps))
{connection_kbps=1;}
document.cookie='yarii_bandwidth='+connection_kbps+'; path=/';};speedTest();}(this.yarii=this.yarii||{},this,document,navigator));